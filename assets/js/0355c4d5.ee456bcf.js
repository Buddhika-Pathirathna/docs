"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[5717],{3905:function(e,t,a){a.d(t,{Zo:function(){return p},kt:function(){return h}});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(a),h=i,m=u["".concat(l,".").concat(h)]||u[h]||d[h]||r;return a?n.createElement(m,o(o({ref:t},p),{},{components:a})):n.createElement(m,o({ref:t},p))}));function h(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var c=2;c<r;c++)o[c]=a[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},3208:function(e,t,a){a.r(t),a.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return d}});var n=a(3117),i=a(102),r=(a(7294),a(3905)),o=["components"],s={},l="Set Up a Private Casper Network",c={unversionedId:"workflow/setup-private-network",id:"workflow/setup-private-network",title:"Set Up a Private Casper Network",description:"Casper private networks operate in a similar way to the Casper public network. The significant difference in private networks is a closed validator set and having administrator account(s) which can control regular accounts. Hence, there are specific configurations when setting up the genesis block and administrator accounts. Besides the main configuration options that the Casper platform provides, each customer may add other configuration options when setting up a private network.",source:"@site/source/docs/casper/workflow/setup-private-network.md",sourceDirName:"workflow",slug:"/workflow/setup-private-network",permalink:"/workflow/setup-private-network",editUrl:"https://github.com/casper-network/docs/tree/main/source/docs/casper/workflow/setup-private-network.md",tags:[],version:"current",frontMatter:{},sidebar:"workflow",previous:{title:"Funding Testnet Accounts",permalink:"/workflow/testnet-faucet"},next:{title:"Development Prerequisites",permalink:"/workflow/setup"}},p={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1. Setting up a Validator Node",id:"step-1-setting-up-a-validator-node",level:2},{value:"Step 2. Setting up the Directory",id:"step-2-setting-up-the-directory",level:2},{value:"Step 3. Configuring the Genesis Block",id:"step-3-configuring-the-genesis-block",level:2},{value:"Unrestricted transfers configuration",id:"unrestricted-transfers-configuration",level:3},{value:"Refund handling configuration",id:"refund-handling-configuration",level:3},{value:"Fee handling configuration",id:"fee-handling-configuration",level:3},{value:"Auction behavior configuration",id:"auction-behavior-configuration",level:3},{value:"Step 4. Configuring the Administrator Accounts",id:"step-4-configuring-the-administrator-accounts",level:2},{value:"Configuring administrator accounts",id:"configuring-administrator-accounts",level:3},{value:"Generating new administrator accounts",id:"generating-new-administrator-accounts",level:3},{value:"Managing accounts and smart contracts",id:"managing-accounts-and-smart-contracts",level:3},{value:"Step 5. Starting the Casper Node",id:"step-5-starting-the-casper-node",level:2},{value:"Step 6. Rotating the Validator Accounts",id:"step-6-rotating-the-validator-accounts",level:2},{value:"Step 7. Testing the Private Network",id:"step-7-testing-the-private-network",level:2},{value:"Sample configuration files",id:"sample-configuration-files",level:3},{value:"Specifying IP addresses",id:"specifying-ip-addresses",level:3},{value:"Setting up the node",id:"setting-up-the-node",level:3},{value:"Funding Alice&#39;s account",id:"funding-alices-account",level:3},{value:"Adding a bid as Alice",id:"adding-a-bid-as-alice",level:3},{value:"Disabling Alice&#39;s account",id:"disabling-alices-account",level:3},{value:"Enabling Alice&#39;s account",id:"enabling-alices-account",level:3},{value:"Enabling a contract",id:"enabling-a-contract",level:3},{value:"Disabling a contract",id:"disabling-a-contract",level:3},{value:"Verifying seigniorage allocations",id:"verifying-seigniorage-allocations",level:3},{value:"Rotating validators",id:"rotating-validators",level:3},{value:"Adding new administrators",id:"adding-new-administrators",level:3}],u={toc:d};function h(e){var t=e.components,a=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"set-up-a-private-casper-network"},"Set Up a Private Casper Network"),(0,r.kt)("p",null,"Casper private networks operate in a similar way to the Casper public network. The significant difference in private networks is a closed validator set and having administrator account(s) which can control regular accounts. Hence, there are specific configurations when setting up the genesis block and administrator accounts. Besides the main configuration options that the Casper platform provides, each customer may add other configuration options when setting up a private network."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"Follow these guides to set up the required environment and user accounts."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/workflow/setup/#the-casper-command-line-client"},"Setting up the Casper client")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/casper-network/casper-node/blob/master/client/README.md#casper-client"},"Setting up the client for interacting with the network")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/workflow/setup/#setting-up-an-account"},"Setting up an account"))),(0,r.kt)("h2",{id:"step-1-setting-up-a-validator-node"},"Step 1. Setting up a Validator Node"),(0,r.kt)("p",null,"A ",(0,r.kt)("a",{parentName:"p",href:"/glossary/N/#node"},"Casper node")," is a physical or virtual device participating in the Casper network. You need to set up several ",(0,r.kt)("a",{parentName:"p",href:"/glossary/V/#validator"},"validator")," nodes on your private network. An ",(0,r.kt)("a",{parentName:"p",href:"/glossary/O/#operator"},"operator")," who has won an ",(0,r.kt)("a",{parentName:"p",href:"/glossary/A/#auction"},"auction")," bid will be a validator for the private network."),(0,r.kt)("p",null,"Use the below guides to set up and manage validator nodes."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/casper-network/casper-node/tree/master/resources/production#casper-node-setup"},"Casper node setup - GitHub guide"),": A guide to configuring a system with the new Rust node to operate within a network."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/operators/setup/"},"Basic node setup tutorial"),": A guide on using the ",(0,r.kt)("inlineCode",{parentName:"li"},"casper-node-launcher"),", generating directories and files needed for running casper-node versions and performing upgrades, generating keys, and setting up the configuration file for nodes."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.cspr.community/"},"Set up Mainnet and Testnet validator nodes"),": A set of guides for Mainnet and Testnet node-operators on setting up and configuring their Casper network validator nodes.")),(0,r.kt)("p",null,"Use these FAQ collections for tips and details for validators."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.casperlabs.io/faq/faq-validator/"},"FAQs for basic validator node ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.cspr.community/docs/faq-validator.html"},"FAQs on Main Net and Test Net validator node setup"))),(0,r.kt)("h2",{id:"step-2-setting-up-the-directory"},"Step 2. Setting up the Directory"),(0,r.kt)("p",null,"Use these guides to set up your private network directories. You will find several main directories dedicated to different purposes."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Go through the ",(0,r.kt)("a",{parentName:"li",href:"/operators/setup/#file-locations"},"file location")," section to understand how directories are created and managed in a Casper private network."),(0,r.kt)("li",{parentName:"ul"},"Refer to the ",(0,r.kt)("a",{parentName:"li",href:"/operators/create/"},"setting up a new network")," guide to identify the required configuration files to set up a genesis block.")),(0,r.kt)("h2",{id:"step-3-configuring-the-genesis-block"},"Step 3. Configuring the Genesis Block"),(0,r.kt)("p",null,"A Casper private network contains a different set of configurations when compared to the public network. The ",(0,r.kt)("inlineCode",{parentName:"p"},"chainspec.toml")," file contains the required configurations for the genesis process in a private network."),(0,r.kt)("p",null,"You should add the configuration options below to the ",(0,r.kt)("inlineCode",{parentName:"p"},"chainspec.toml")," file inside the ",(0,r.kt)("a",{parentName:"p",href:"/workflow/setup-private-network/#step-2-setting-up-the-directory"},"private network directory"),"."),(0,r.kt)("h3",{id:"unrestricted-transfers-configuration"},"Unrestricted transfers configuration"),(0,r.kt)("p",null,"This option disables unrestricted transfers between regular accounts. A regular account user cannot do a fund transfer when this attribute is set to false. Only administrators can transfer tokens freely between users and other administrators."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"[core];\nallow_unrestricted_transfers = false;\n")),(0,r.kt)("p",null,"In contrast, users in the public network can freely transfer funds to different accounts."),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"A Casper private network doesn't support the minting process. Only admininstrator accounts can maintain funds. This is enabled by configuring these options:")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'[core];\nallow_unrestricted_transfers = false;\ncompute_rewards = false;\nallow_auction_bids = false;\nrefund_handling = { type = "refund", refund_ratio = [1, 1] };\nfee_handling = { type = "accumulate" };\nadministrators = ["ADMIN_PUBLIC_KEY"];\n')))),(0,r.kt)("h3",{id:"refund-handling-configuration"},"Refund handling configuration"),(0,r.kt)("p",null,"This option manages the refund behavior at the finalization of a deploy execution. It changes the way the Wasm execution fees are distributed. After each deploy execution, the network calculates the amount of gas spent for the execution and manages to refund any remaining tokens to the user."),(0,r.kt)("p",null,"A ",(0,r.kt)("inlineCode",{parentName:"p"},"refund_ratio")," is specified as a proper fraction (the numerator must be lower or equal to the denominator). In the example below, the ",(0,r.kt)("inlineCode",{parentName:"p"},"refund_ratio")," is 1:1. If 2.5 CSPR is paid upfront and the gas fee is 1 CSPR, 1.5 CSPR will be given back to the user."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'[core];\nrefund_handling = { type = "refund", refund_ratio = [1, 1] };\n')),(0,r.kt)("p",null,"After deducting the gas fee, the distribution of the remaining payment amount is handled based on the ",(0,r.kt)("a",{parentName:"p",href:"/workflow/setup-private-network/#fee-handling-config"},"fee_handling")," configuration."),(0,r.kt)("p",null,"The default configuration for a public chain, including the Casper Mainet, looks like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'[core];\nrefund_handling = { type = "refund", refund_ratio = [0, 100] };\n')),(0,r.kt)("p",null,"The refund variant with ",(0,r.kt)("inlineCode",{parentName:"p"},"refund_ratio")," of ","[0, 100]"," means that 0% is given back to the user after deducting gas fees. In other words, if a user paid 2.5 CSPR and the gas fee is 1 CSPR, the user will not get the remaining 1.5 CSPR in return."),(0,r.kt)("h3",{id:"fee-handling-configuration"},"Fee handling configuration"),(0,r.kt)("p",null,"This option defines how to distribute the fees after refunds are handled. While refund handling defines the amount we pay back after a transaction, fee handling defines the methods of fee distribution after a refund is performed."),(0,r.kt)("p",null,"Set up the configuration as below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'[core];\nfee_handling = { type = "pay_to_proposer" };\n')),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"fee_handling")," configuration has three variations:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"pay_to_proposer"),": The rest of the payment amount after deducing the gas fee from a refund is paid to the block's ",(0,r.kt)("a",{parentName:"li",href:"/glossary/P/#proposer"},"proposer"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"burn"),": The tokens paid are burned, and the total supply is reduced."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"accumulate"),": The funds are transferred to a special accumulation purse. Here, the accumulation purse is owned by a handle payment system contract, and the amount is distributed among all the administrators defined at the end of a switch block. The fees are paid to the purse owned by the handle payment contract, and no tokens are transferred to the proposer when this configuration is enabled.")),(0,r.kt)("h3",{id:"auction-behavior-configuration"},"Auction behavior configuration"),(0,r.kt)("p",null,"A private network requires to have a fixed set of validators. This configuration restricts the addition of new validators to the private network. Hence, you are not allowed to bid new entries into the validator set."),(0,r.kt)("p",null,"Use the configuration below to limit the auction validators:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"[core];\nallow_auction_bids = false;\n")),(0,r.kt)("p",null,"Other configurations related to the auction:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"allow_auction_bids")," - if this option is set to ",(0,r.kt)("em",{parentName:"li"},"false")," then ",(0,r.kt)("inlineCode",{parentName:"li"},"add_bid")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"delegate")," options are disabled. It also disables adding new validators to the system. Invoking those entry points leads to an ",(0,r.kt)("inlineCode",{parentName:"li"},"AuctionBidsDisabled")," error."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"core.compute_rewards")," - if this option is set to ",(0,r.kt)("em",{parentName:"li"},"false"),", then all the rewards on a switch block will be set to 0. The auction contract wouldn't process rewards distribution that would increase validator bids.")),(0,r.kt)("p",null,"In a public network, ",(0,r.kt)("inlineCode",{parentName:"p"},"allow_auction_bid")," is set to ",(0,r.kt)("em",{parentName:"p"},"true"),", which allows bidding for new entries and validator nodes."),(0,r.kt)("h2",{id:"step-4-configuring-the-administrator-accounts"},"Step 4. Configuring the Administrator Accounts"),(0,r.kt)("p",null,"An administrator is mandatory for a private network since it manages all the other ",(0,r.kt)("a",{parentName:"p",href:"/glossary/V/#validator"},"validator")," accounts. There should be at least one administrator account configured within a network to operate it as a ",(0,r.kt)("inlineCode",{parentName:"p"},"private network"),". You can create new administrators and ",(0,r.kt)("a",{parentName:"p",href:"/workflow/setup-private-network/#step-6-rotating-the-validator-accounts"},"rotate the validator set")," in a single configuration update. The operator must first ensure the ",(0,r.kt)("inlineCode",{parentName:"p"},"global_state.toml")," file contains new administrators. The validator set is updated after if an administrator is also a validator. Also, only the administrator accounts can hold and distribute token balances."),(0,r.kt)("h3",{id:"configuring-administrator-accounts"},"Configuring administrator accounts"),(0,r.kt)("p",null,"Use this configuration option in the ",(0,r.kt)("inlineCode",{parentName:"p"},"chainspec.toml")," to add administrator accounts to the private network:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'[core];\nadministrators = ["NEW_ACCOUNT_PUBLIC_KEY"];\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note"),": Regular accounts are not allowed to manage their associated keys on a private network."),(0,r.kt)("h3",{id:"generating-new-administrator-accounts"},"Generating new administrator accounts"),(0,r.kt)("p",null,"Use the command below to generate new administrator accounts in your private network. This generates the contents of a ",(0,r.kt)("inlineCode",{parentName:"p"},"global_state.toml")," with the entries required to create new administrator accounts at the upgrade point."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"global-state-update-gen \\\n  generate-admins --data-dir $DATA_DIR/global_state \\\n  --state-hash $STATE_ROOT_HASH \\\n  --admin $PUBLIC_KEY_HEX, $BALANCE\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"NEW_PUBLIC_KEY")," - Public key of the administrator in a hex format."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"NEW_BALANCE")," - Balance for the administrator\u2019s main purse."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"DATA_DIR")," - Path to the global state directory."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"STATE_ROOT_HASH")," - State root hash, taken from the latest block before an upgrade.")),(0,r.kt)("h3",{id:"managing-accounts-and-smart-contracts"},"Managing accounts and smart contracts"),(0,r.kt)("p",null,"Only administrators have permission to control accounts and manage smart contracts in a private network. An example implementation can be found in ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/casper-network/casper-node/blob/c8023736786b2c2b0fd17250fcfd50502ff4151f/smart_contracts/contracts/private_chain/control-management/src/main.rs"},"Casper node's private chain control management")," file. This is not an existing contract. You can use the existing client contracts as an administrator to perform actions as a user. This is done by sending a deploy under a regular user's public key but signed using the administrator's secret key."),(0,r.kt)("p",null,"Use this command to generate these contracts:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"make build-contracts-rs\n")),(0,r.kt)("p",null,"Only the administrator can use the related Wasm to send the deploy to the network and then use it to manage, enable, and disable contracts. This is achieved through entry points that handle enabling and disabling options for account and smart contracts:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"To disable a contract"),": Execute the ",(0,r.kt)("inlineCode",{parentName:"li"},"disable_contract.wasm")," with ",(0,r.kt)("inlineCode",{parentName:"li"},"contract_hash"),"and ",(0,r.kt)("inlineCode",{parentName:"li"},"contract_package_hash")," as parameters."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"To enable a contract"),": Execute the ",(0,r.kt)("inlineCode",{parentName:"li"},"enable_contract.wasm")," with ",(0,r.kt)("inlineCode",{parentName:"li"},"contract_hash"),"and ",(0,r.kt)("inlineCode",{parentName:"li"},"contract_package_hash")," as parameters."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"To disable an account"),": Execute ",(0,r.kt)("inlineCode",{parentName:"li"},"set_action_thresholds.wasm")," with argument ",(0,r.kt)("inlineCode",{parentName:"li"},"deploy_threshold:u8='255'")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"key_management_threshold:u8='0'"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"To enable an account"),": Execute ",(0,r.kt)("inlineCode",{parentName:"li"},"set_action_thresholds.wasm")," with ",(0,r.kt)("inlineCode",{parentName:"li"},"deploy_threshold:u8='1'")," set to 1 and ",(0,r.kt)("inlineCode",{parentName:"li"},"key_management_threshold:u8='0'"),".")),(0,r.kt)("h2",{id:"step-5-starting-the-casper-node"},"Step 5. Starting the Casper Node"),(0,r.kt)("p",null,"After preparing the administrator accounts and validator nodes, you should start and run the Casper node to see the changes. Use this command to start the node:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl start casper-node-launcher\n")),(0,r.kt)("p",null,"Refer to the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/casper-network/casper-node/tree/master/resources/production#casper-node-setup"},"Casper node setup GitHub")," guide to know more details about configuring a new node to operate within a network."),(0,r.kt)("p",null,"Additionally, refer to the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/casper-network/casper-node-launcher"},"casper-node-launcher")," to check whether the installed node binaries match the installed configurations by comparing the version numbers."),(0,r.kt)("h2",{id:"step-6-rotating-the-validator-accounts"},"Step 6. Rotating the Validator Accounts"),(0,r.kt)("p",null,"You need to go through ",(0,r.kt)("a",{parentName:"p",href:"/#step-1-setting-up-the-validator-nodes"},"setting up a validator node ")," guide before starting this section."),(0,r.kt)("p",null,"Use this command to create content in the ",(0,r.kt)("inlineCode",{parentName:"p"},"global_state.toml")," file to rotate the validator set. Specify all the current validators, their stakes, and new accounts."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"global-state-update-gen \\\n  validators --data-dir $DATA_DIR/global_state \\\n  --state-hash $STATE_ROOT_HASH \\\n  \u2013validator $PUBLIC_KEY_HEX,$STAKE,$OPTIONAL_DELEGATION_RATE\n")),(0,r.kt)("p",null,"To rotate the validators set, perform a network upgrade with a ",(0,r.kt)("inlineCode",{parentName:"p"},"global_state.toml")," with new entries generated by the ",(0,r.kt)("inlineCode",{parentName:"p"},"global-state-update-gen")," command."),(0,r.kt)("p",null,"You can find more details on enabling new validators in the ",(0,r.kt)("a",{parentName:"p",href:"/operators/joining/"},"joining a running network")," guide. The guide explains how to join the network and provide additional security to the system."),(0,r.kt)("h2",{id:"step-7-testing-the-private-network"},"Step 7. Testing the Private Network"),(0,r.kt)("p",null,"We will describe the testing flow using an example customer and the configuration below. These options are relative to this example customer."),(0,r.kt)("h3",{id:"sample-configuration-files"},"Sample configuration files"),(0,r.kt)("p",null,"Here are sample configurations that can be adapted for testing:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/casper-network/casper-node/blob/0b4eead8ea1adffaea98260fe2e69dfc8b71c092/resources/private/chainspec.toml.in"},"chainspec template")," that is specific to the customer's private chain."),(0,r.kt)("li",{parentName:"ul"},"An ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/casper-network/casper-node/blob/0b4eead8ea1adffaea98260fe2e69dfc8b71c092/resources/private/accounts.toml.in"},"accounts template")," with one administrator in the ",(0,r.kt)("inlineCode",{parentName:"li"},"administrators")," settings.")),(0,r.kt)("h3",{id:"specifying-ip-addresses"},"Specifying IP addresses"),(0,r.kt)("p",null,"Here is an example set of IP addresses in use:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"http://18.224.190.213:7777\nhttp://18.188.11.97:7777\nhttp://18.188.206.170:7777\nhttp://18.116.201.114:7777\n")),(0,r.kt)("h3",{id:"setting-up-the-node"},"Setting up the node"),(0,r.kt)("p",null,"Set up the node address, chain name, and the administrator's secret key."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},'export NODE_ADDR=http://18.224.190.213:7777\nexport CHAIN_NAME="private-test"\n')),(0,r.kt)("p",null,"This testing example will also use an ",(0,r.kt)("inlineCode",{parentName:"p"},"alice/secret_key.pem")," file, a secret key generated through the ",(0,r.kt)("a",{parentName:"p",href:"/dapp-dev-guide/keys/#creating-accounts-and-keys"},"keys generation process"),". Alice is a regular user in this testing example."),(0,r.kt)("h3",{id:"funding-alices-account"},"Funding Alice's account"),(0,r.kt)("p",null,"The following command transfers tokens to Alice's account."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client \\\n  transfer \\\n  -n $NODE_ADDR \\\n  --chain-name $CHAIN_NAME \\\n  --secret-key admin/secret_key.pem \\\n  --session-account=$(<admin/public_key_hex) \\\n  --target-account=$(<alice/public_key_hex) \\\n  --amount=100000000000 \\\n  --payment-amount=3000000000 \\\n  --transfer-id=123\n")),(0,r.kt)("p",null,"To check the account information, use this command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-account-info -n $NODE_ADDR\n  --public-key alice/public_key.pem\n")),(0,r.kt)("h3",{id:"adding-a-bid-as-alice"},"Adding a bid as Alice"),(0,r.kt)("p",null,"The following command attempts to add an auction bid on the network. It should return ",(0,r.kt)("inlineCode",{parentName:"p"},"ApiError::AuctionError(AuctionBidsDisabled) [64559]"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'casper-client \\\n  put-deploy \\\n  -n $NODE_ADDR \\\n  --chain-name $CHAIN_NAME \\\n  --secret-key alice/secret_key.pem \\\n  --session-path add_bid.wasm \\\n  --payment-amount 5000000000 \\\n  --session-arg "public_key:public_key=\'$(<alice/public_key_hex)\'" \\\n  --session-arg "amount:u512=\'10000\'" \\\n  --session-arg "delegation_rate:u8=\'5\'"\n\n# Error: ApiError::AuctionError(AuctionBidsDisabled) [64559]"\n')),(0,r.kt)("p",null,"We should get a similar error for the delegate entry point."),(0,r.kt)("h3",{id:"disabling-alices-account"},"Disabling Alice's account"),(0,r.kt)("p",null,"The following command disables Alice's account. In this case, executing deploys with Alice's account will not be successful."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client \\\n  put-deploy \\\n  -n $NODE_ADDR \\\n  --chain-name $CHAIN_NAME \\\n  --secret-key admin/secret_key.pem \\\n  --session-account=alice/public_key_hex\n  --session-path set_action_thresholds.wasm \\\n  --payment-amount=2500000000 \\\n  --session-arg \"key_management_threshold:u8='0'\" \\\n  --session-arg \"deploy_threshold:u8='1'\"\n")),(0,r.kt)("h3",{id:"enabling-alices-account"},"Enabling Alice's account"),(0,r.kt)("p",null,"The following command enables Alice's account. In this case, executing deploys with Alice's account will be successful."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client \\\n  put-deploy \\\n  -n $NODE_ADDR \\\n  --chain-name $CHAIN_NAME \\\n  --secret-key admin/secret_key.pem \\\n  --session-account=alice/public_key_hex\n  --session-path set_action_thresholds.wasm \\\n  --payment-amount=2500000000 \\\n  --session-arg \"key_management_threshold:u8='255'\" \\\n  --session-arg \"deploy_threshold:u8='255'\"\n")),(0,r.kt)("h3",{id:"enabling-a-contract"},"Enabling a contract"),(0,r.kt)("p",null,"The following command enables a contract using its hash."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client \\\n  put-deploy \\\n  -n $NODE_ADDR \\\n  --chain-name $CHAIN_NAME \\\n  --secret-key admin/secret_key.pem \\\n  --session-account=$(<alice/public_key_hex) \\\n  --session-path enable_contract.wasm \\\n  --payment-amount 3000000000 \\\n  --session-arg \"contract_package_hash:account_hash='account-hash-$CONTRACT_PACKAGE_HASH'\" \\\n  --session-arg \"contract_hash:account_hash='account-hash-$CONTRACT_HASH'\"\n")),(0,r.kt)("h3",{id:"disabling-a-contract"},"Disabling a contract"),(0,r.kt)("p",null,"The following command disables a contract using its hash. Executing this contract using ",(0,r.kt)("inlineCode",{parentName:"p"},"CONTRACT_HASH")," again should fail."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client \\\n  put-deploy \\\n  -n $NODE_ADDR \\\n  --chain-name $CHAIN_NAME \\\n  --secret-key admin/secret_key.pem \\\n  --session-account=$(<alice/public_key_hex) \\\n  --session-path disable_contract.wasm \\\n  --payment-amount 3000000000 \\\n  --session-arg \"contract_package_hash:account_hash='account-hash-$CONTRACT_PACKAGE_HASH'\" \\\n  --session-arg \"contract_hash:account_hash='account-hash-$CONTRACT_HASH'\"\n")),(0,r.kt)("p",null,"Alice needs a container access key for the contract package in her named keys."),(0,r.kt)("h3",{id:"verifying-seigniorage-allocations"},"Verifying seigniorage allocations"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.investopedia.com/terms/s/seigniorage.asp"},"Seigniorage")," allocations should be zero at each switch block. This is the related configuration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"[core];\ncompute_rewards = false;\n")),(0,r.kt)("p",null,"Validator stakes should not increase on each switch block. Run this command to verify this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-era-info -n $NODE_ADDR -b 153\n")),(0,r.kt)("p",null,"The total supply shouldn't increase, and the validator's stakes should remain the same."),(0,r.kt)("h3",{id:"rotating-validators"},"Rotating validators"),(0,r.kt)("p",null,"The following command rotates the validator set. Perform a network upgrade with a ",(0,r.kt)("inlineCode",{parentName:"p"},"global_state.toml")," with the new entries generated by the ",(0,r.kt)("inlineCode",{parentName:"p"},"global-state-update-gen")," command."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"global-state-update-gen validators \\\n  --data-dir $DATA_DIR \\\n  --state-hash $STATE_ROOT_HASH \\\n  --validator NEW_PUBLIC_KEY,NEW_STAKE \\\n  --validator NEW_PUBLIC_KEY2,NEW_STAKE2\n")),(0,r.kt)("h3",{id:"adding-new-administrators"},"Adding new administrators"),(0,r.kt)("p",null,"The following command produces the administrator content in the ",(0,r.kt)("inlineCode",{parentName:"p"},"global_state.toml")," file."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"global-state-update-gen generate-admins --admin NEW_PUBLIC_KEY,NEW_BALANCE --data-dir $DATA_DIR --state-hash $STATE_ROOT_HASH\n")),(0,r.kt)("p",null,"Remember that new administrators can be created, and the validator set can also be rotated in a single update."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"chainspec.toml")," file should contain the following entries that include new administrators as well as existing ones for an upgrade:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'[core];\nadministrators = ["NEW_PUBLIC_KEY"];\n')),(0,r.kt)("p",null,"After this step, the private network would be ready for use."))}h.isMDXComponent=!0}}]);